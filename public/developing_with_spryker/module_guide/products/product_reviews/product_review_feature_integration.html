<!DOCTYPE html>
<html id="spryker-academy" lang="en-us" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developing with Spryker|Module Guide|Products|Product Reviews">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
        <meta name="author" content="Spryker Systems GmbH" />
        <meta name="title" content="Spryker Academy" />
        <meta name="msapplication-config" content="/resources/ui/images/favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="/resources/ui/images/favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="/resources/ui/images/favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="/resources/ui/images/favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="/resources/ui/images/favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="/resources/ui/images/favicons/favicon-16x16.png" />
        <!-- Google Tag Manager -->
        <script>/*<![CDATA[*/(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-NP24S2');/*]]>*/</script>
        <!-- End Google Tag Manager --><title>Feature Integration - Product Reviews</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <style>@import url('https://fonts.googleapis.com/css?family=Lato:300,400,400i,900');

</style>
        <link href="/resources/ui/css/academy-ui-typography.css" rel="stylesheet" />
        <link href="/resources/ui/css/academy-ui-app.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../../resources/ui/css/academy-ui-typography.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body class="t-base t-base--page js-base-template">
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP24S2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
        </noscript>
        <!-- End Google Tag Manager (noscript) -->
        <div class="t-base__header">
            <header class="o-header">
                <div class="o-header__content g-grid g-grid--container g-grid--middle"><a class="m-logo g-col g-col--sm-10 g-col--lg-2" href="/"><img class="m-logo__image" src="/resources/ui/images/logo.png" alt="Spryker Logo" /></a>
                    <nav class="m-nav-top g-col g-col--sm-2 g-col--lg-10" id="nav-top">
                        <div class="u-is-hidden--sm-xl">
                            <ul class="nocontent menu mc-component" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                            </ul>
                        </div>
                        <div class="u-is-hidden--xl"><a class="m-nav-top__toggler js-base-template__toggler" href="#"><span class="icon icon-bars"></span></a>
                        </div>
                    </nav>
                </div>
            </header>
        </div>
        <div class="t-base__frame">
            <section class="o-search">
                <div class="g-grid g-grid--container">
                    <section class="m-search g-col g-col--sm-12">
                        <form action="/search.html" method="GET">
                            <input class="a-input a-input--expanded m-search__input" placeholder="Search in the Academy..." name="q" />
                            <button class="m-search__submit" type="submit"><span class="icon icon-search"></span>
                            </button>
                        </form>
                    </section>
                </div>
            </section>
            <section class="t-base__widgets g-grid g-grid--container g-grid--middle">
                <section class="m-breadcrumbs g-col g-col--sm-12 g-col--xl-8">
                    <div class="nocontent">
                        <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                        </div>
                    </div>
                </section>
                <div class="g-col g-col--sm-12 g-col--xl-4 u-align-right">
                    <section class="m-widget-toolbar">
                        <div class="buttons popup-container clearfix topicToolbarProxy _Skins_topic_toolbar mc-component nocontent">
                            <div class="button-group-container-left">
                                <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                </button>
                                <button class="button needs-pie next-topic-button" title="Navigate next">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                </button>
                                <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                </button>
                                <button class="button needs-pie print-button" title="Print">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                </button>
                            </div>
                        </div>
                    </section>
                    <div class="m-widget-github js-widget-github"><a class="m-widget-github__link icon icon-github js-widget-github__link" href="https://github.com/spryker/spryker-academy" target="_blank"></a>
                    </div>
                </div>
            </section>
            <main class="t-base__main g-grid g-grid--container">
                <div class="g-col g-col--sm-12 u-is-hidden--xl">
                    <div class="m-accordion js-accordion">
                        <div class="m-accordion__header">
                            <div class="m-accordion__title js-accordion__toggler"><span class="icon icon-ellipsis-v icon--left"></span>
                    Navigation
                </div>
                        </div>
                        <div class="m-accordion__content js-accordion__content">
                            <nav class="m-nav-sidebar" id="nav-sidebar">
                                <ul class="nocontent menu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="t-page-sidebar__content o-content g-col g-col--sm-12 g-col--xl-8 js-anchorer js-highlighter js-widget-copy">
                    <h1>Feature Integration - Product Reviews</h1>
                    <h2>Prerequisites</h2>
                    <p>To prepare your project to work with Product Reviews:</p>
                    <ol>
                        <li value="1">Require the Product Review modules in your <var>composer</var> by running
            <ul><li value="1"><var>composer require spryker/product-review</var></li><li value="2"><var>composer require spryker/product-review-collector</var></li><li value="3"><var>composer require spryker/product-review-gui</var></li></ul></li>
                        <li value="2">Install the new database tables by running <var>vendor/bin/console propel:diff</var>. Propel should generate a migration file with the changes.</li>
                        <li value="3">Run <var>vendor/bin/console propel:migrate</var> to apply the database changes.</li>
                        <li value="4">Generate ORM models by running <var>vendor/bin/console propel:model:build</var>.
            <p>This command will generate some new classes in your project under <var>\Orm\Zed\ProductReview\Persistence</var> namespace.
                    It is important to make sure that they extend the base classes from the Spryker core, e.g.:</p><ul><li value="1"><var>\Orm\Zed\ProductReview\Persistence\SpyProductReview</var> extends <var>\Spryker\Zed\ProductReview\Persistence\Propel\AbstractSpyProductReview</var></li><li value="2"><var>\Orm\Zed\ProductReview\Persistence\SpyProductReviewQuery</var> extends <var>\Spryker\Zed\ProductReview\Persistence\Propel\AbstractSpyProductReviewQuery</var></li></ul></li>
                        <li value="5">Run <var>vendor/bin/console transfer:generate</var> to generate the new transfer objects.</li>
                        <li value="6">
            Activate the product review collectors by adding the <var>ProductReviewCollectorSearchPlugin </var>and the <var>ProductAbstractReviewCollectorStoragePlugin </var>to the Storage and Search Collector plugin stack.
            <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: collector plugin list extension</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="php">&lt;?php

    namespace Pyz\Zed\Collector;

    use Spryker\Zed\Collector\CollectorDependencyProvider as SprykerCollectorDependencyProvider;
    use Spryker\Zed\Kernel\Container;
    use Spryker\Zed\ProductReviewCollector\Communication\Plugin\ProductReviewCollectorSearchPlugin;
    use Spryker\Zed\ProductReviewCollector\Communication\Plugin\ProductAbstractReviewCollectorStoragePlugin;
    // ...

    class CollectorDependencyProvider extends SprykerCollectorDependencyProvider
    {
        /**
         * @param \Spryker\Zed\Kernel\Container $container
         *
         * @return \Spryker\Zed\Kernel\Container
         */
        public function provideBusinessLayerDependencies(Container $container)
        {
            // ...

            $container[static::SEARCH_PLUGINS] = function (Container $container) {
                return [
                    // ...
                    ProductReviewConfig::RESOURCE_TYPE_PRODUCT_REVIEW =&gt; new ProductReviewCollectorSearchPlugin(),
                ];
            };

            $container[static::STORAGE_PLUGINS] = function (Container $container) {
                return [
                    // ...
                    ProductReviewConfig::RESOURCE_TYPE_PRODUCT_ABSTRACT_REVIEW =&gt; new ProductAbstractReviewCollectorStoragePlugin(),
                ];
            };


            // ...
        }
    }</code></pre></div></div></li>
                        <li value="7">Run <var>vendor/bin/console setup:search</var> to set up Search before you run Search collectors.</li>
                        <li value="8">Make sure the new Zed user interface assets are built by running <var>npm run zed</var> (or antelope build zed for older versions).</li>
                        <li value="9">Update Zed’s navigation cache to show the new items for the Product Review management user interface by running <var>vendor/bin/console application:build-navigation-cache</var>.</li>
                    </ol>
                    <p>You should now be able to use the Zed API of Product Reviews to approve, reject and delete reviews, and the collectors should also be able to push approved reviews and ratings into Storage and Search.
        Check out our <a href="https://github.com/spryker/demoshop">Demoshop implementation</a> for frontend implementation example and idea.</p>
                    <h2>Usage in Yves</h2>
                    <h3>Submitting a Product Review</h3>
                    <p>To store an already validated product review, populate a <var>\Generated\Shared\Transfer\ProductReviewTransfer</var> transfer object and send it to Zed by calling the <var>\Spryker\Client\ProductReview\ProductReviewClientInterface::submitCustomerReview</var> method.</p>
                    <p>This action will create a new pending product review in your persistent storage. The saved product review will be exported to Search and Storage after it was approved on Zed UI.</p>
                    <p>Make sure that the provided <var>rating</var> value does not exceed the <a href="product_review_feature_configuration.html#configure-maximum-rating">configured maximum rating</a> limit.</p>      Example of how to store a validated customer review:
			<pre><code class="php">&lt;?php

    /**
     * @method \Pyz\Yves\ProductReview\ProductReviewFactory getFactory()
     */
    class SubmitController extends Pyz\Yves\Application\Controller\AbstractController
    {
        /**
         * @param \Symfony\Component\HttpFoundation\Request $request
         */
        public function submitAction(Request $request)
        {
            $customerReference = $this-&gt;getFactory()-&gt;getCustomerClient()-&gt;getCustomer()-&gt;getCustomerReference();

            $this-&gt;getFactory()-&gt;getProductReviewClient()-&gt;submitCustomerReview(
                (new ProductReviewRequestTransfer())
                        -&gt;setCustomerReference($customerReference)
                        -&gt;setLocaleName($this-&gt;getLocale())
                        -&gt;setIdProductAbstract($request-&gt;attributes-&gt;get('idProductAbstract'))
                        -&gt;setSummary($request-&gt;attributes-&gt;get('summary'))
                        -&gt;setDescription($request-&gt;attributes-&gt;get('description'))
                        -&gt;setRating($request-&gt;attributes-&gt;get('rating'))
                        -&gt;setNickname($request-&gt;attributes-&gt;get('nickname'))
            );
        }
    }
            </code></pre><h3>Displaying an Average Rating</h3><p>To display the average rating stored in Storage, you will need to use <var>spyProductAbstractReview</var> and <var>spyProductAbstractReviewMaximumRating</var> twig extensions shipped by <var>ProductReview</var> module.</p><p><var>spyProductAbstractReview</var> twig extension takes product abstract ID as first argument and injects the corresponding <var>ProductAbstractReviewTransfer</var> transfer object into the twig template provided as the second argument.</p><p><var>spyProductAbstractReviewMaximumRating</var> twig extension allows you to retrieve the <a href="product_review_feature_configuration.html#configure-maximum-rating">configured maximum rating</a> on demand.</p><p>To register these plugins, you need to add <var>ProductAbstractReviewTwigServiceProvider</var> service provider to your <var>\Pyz\Yves\Application\YvesBootstrap.php</var>.</p>Example of how to register twig extensions:<pre><code class="php">&lt;?php
    namespace Pyz\Yves\Application;

    use Spryker\Yves\ProductReview\Plugin\Provider\ProductAbstractReviewTwigServiceProvider;

    class YvesBootstrap
    {
        /**
         * @return void
         */
        protected function registerServiceProviders()
        {
            // ...
            $this-&gt;application-&gt;register(new ProductAbstractReviewTwigServiceProvider());
        }

    }
                    </code></pre><p>Now you will be able to call the registered <var>spyProductAbstractReview</var> and <var>spyProductAbstractReviewMaximumRating</var> twig extensions in your twig templates.</p>Below is the example <var>spyProductAbstractReview</var> call.<p>@ProductReview/index/index.twig:</p><pre><code class="html">
&lt;div&gt;Product name: {{product.name}}&lt;/div&gt;
{{ spyProductAbstractReview(product.idProductAbstract, '@ProductReview/partials/average-rating.twig') }}
                </code></pre><p>The <var>spyProductAbstractReview</var> twig extension will render the template provided as a second argument and inject the <var>productAbstractReviewTransfer</var> variable.</p>Below is the example average-rating.twig implementation.<p>@ProductReview/partials/average-rating.twig:</p><pre><code class="html">
{% block content %}
    {% if productAbstractReviewTransfer %}
        Average product rating is {{ productAbstractReviewTransfer.averageRating }} out of {{ spyProductAbstractReviewMaximumRating() }}
    {% endif %}
{% endblock %}
            </code></pre><h3>Displaying Reviews and Rating Summary</h3><p>To display previously posted and already approved reviews from Search, you will need to call <var>\Spryker\Client\ProductReview\ProductReviewClientInterface::findProductReviewsInSearch</var> method.</p><p>To alter the retrieved number of product reviews per page, change the <a href="product_review_feature_configuration.html#configure-elements-per-page">Client configuration</a>.</p>Example of product review retrieval:<pre><code class="php">
namespace Pyz\Yves\ProductReview\Controller;

use Generated\Shared\Transfer\ProductReviewSearchRequestTransfer;
use Pyz\Yves\Application\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Request;

/**
 * @method \Spryker\Client\ProductReview\ProductReviewClientInterface getClient()
 */
class IndexController extends AbstractController
{

    /**
     * @param \Symfony\Component\HttpFoundation\Request $request
     *
     * @return array
     */
    public function indexAction(Request $request)
    {
        $productReviews = $this-&gt;getClient()-&gt;findProductReviewsInSearch(
            (new ProductReviewSearchRequestTransfer())
                -&gt;setIdProductAbstract($request-&gt;attributes-&gt;get('idProductAbstract'));
                -&gt;setRequestParams($request-&gt;query-&gt;all())
        );

        return [
            'productReviews' =&gt; $productReviews['productReviews'],
            'pagination' =&gt; $productReviews['pagination'],
            'ratingAggregation' =&gt; $productReviews['ratingAggregation'],
        ];
    }

}

            </code></pre><p>&#160;</p><p><![CDATA[
		
		]]><i>Last review date: Aug. 28, 2017 </i></p></div>
                <div class="t-page-sidebar__sidebar g-col g-col--sm-12 g-col--xl-4 u-is-hidden--sm-xl">
                    <section class="a-box a-box--shadow">
                        <nav class="m-nav-sidebar" id="nav-sidebar">
                            <ul class="nocontent menu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                            </ul>
                        </nav>
                    </section>
                </div>
            </main>
            <div class="t-base__footer">
                <footer class="o-footer g-grid g-grid--middle">
                    <nav class="g-grid g-grid--container g-grid--center"><a class="o-footer__link" href="https://spryker.com/privacy-policy" target="_blank">Privacy policy</a><a class="o-footer__link" href="https://spryker.com/partneragb" target="_blank">AGB Partnerprogram</a><a class="o-footer__link" href="https://spryker.com/impressum" target="_blank">Impressum</a>
                    </nav>
                </footer>
            </div><a class="a-scroll-top js-scroll-top" href="#"><span class="a-scroll-top__icon icon icon-chevron-up"></span></a>
            <div class="t-base__overlay js-base-template__toggler">
            </div>
        </div>
        <div class="t-base__off">
            <section class="o-off-canvas">
                <nav class="m-nav-mobile" id="nav-mobile">
                    <ul class="nocontent menu mc-component" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                    </ul>
                </nav>
            </section>
        </div>
        <script src="/resources/ui/js/academy-ui-manifest.js">
        </script>
        <script src="/resources/ui/js/academy-ui-vendor.js">
        </script>
        <script src="/resources/ui/js/academy-ui-app.js">
        </script>
    </body>
</html>