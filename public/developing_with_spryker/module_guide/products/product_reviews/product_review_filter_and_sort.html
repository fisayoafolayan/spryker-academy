<!DOCTYPE html>
<html id="spryker-academy" lang="en-us" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developing with Spryker|Module Guide|Products|Product Reviews">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0" />
        <meta name="author" content="Spryker Systems GmbH" />
        <meta name="title" content="Spryker Academy" />
        <meta name="msapplication-config" content="/resources/ui/images/favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="/resources/ui/images/favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="/resources/ui/images/favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="/resources/ui/images/favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="/resources/ui/images/favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="/resources/ui/images/favicons/favicon-16x16.png" />
        <!-- Google Tag Manager -->
        <script>/*<![CDATA[*/(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-NP24S2');/*]]>*/</script>
        <!-- End Google Tag Manager --><title>Filter &amp; Sort by Average Rating - Product Reviews</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <style>@import url('https://fonts.googleapis.com/css?family=Lato:300,400,400i,900');

</style>
        <link href="/resources/ui/css/academy-ui-typography.css" rel="stylesheet" />
        <link href="/resources/ui/css/academy-ui-app.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../../resources/ui/css/academy-ui-typography.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body class="t-base t-base--page js-base-template">
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP24S2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
        </noscript>
        <!-- End Google Tag Manager (noscript) -->
        <div class="t-base__header">
            <header class="o-header">
                <div class="o-header__content g-grid g-grid--container g-grid--middle"><a class="m-logo g-col g-col--sm-10 g-col--lg-2" href="/"><img class="m-logo__image" src="/resources/ui/images/logo.png" alt="Spryker Logo" /></a>
                    <nav class="m-nav-top g-col g-col--sm-2 g-col--lg-10" id="nav-top">
                        <div class="u-is-hidden--sm-xl">
                            <ul class="nocontent menu mc-component" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                            </ul>
                        </div>
                        <div class="u-is-hidden--xl"><a class="m-nav-top__toggler js-base-template__toggler" href="#"><span class="icon icon-bars"></span></a>
                        </div>
                    </nav>
                </div>
            </header>
        </div>
        <div class="t-base__frame">
            <section class="o-search">
                <div class="g-grid g-grid--container">
                    <section class="m-search g-col g-col--sm-12">
                        <form action="/search.html" method="GET">
                            <input class="a-input a-input--expanded m-search__input" placeholder="Search in the Academy..." name="q" />
                            <button class="m-search__submit" type="submit"><span class="icon icon-search"></span>
                            </button>
                        </form>
                    </section>
                </div>
            </section>
            <section class="t-base__widgets g-grid g-grid--container g-grid--middle">
                <section class="m-breadcrumbs g-col g-col--sm-12 g-col--xl-8">
                    <div class="nocontent">
                        <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                        </div>
                    </div>
                </section>
                <div class="g-col g-col--sm-12 g-col--xl-4 u-align-right">
                    <section class="m-widget-toolbar">
                        <div class="buttons popup-container clearfix topicToolbarProxy _Skins_topic_toolbar mc-component nocontent">
                            <div class="button-group-container-left">
                                <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                </button>
                                <button class="button needs-pie next-topic-button" title="Navigate next">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                </button>
                                <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                </button>
                                <button class="button needs-pie print-button" title="Print">
                                    <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                </button>
                            </div>
                        </div>
                    </section>
                    <div class="m-widget-github js-widget-github"><a class="m-widget-github__link icon icon-github js-widget-github__link" href="https://github.com/spryker/spryker-academy" target="_blank"></a>
                    </div>
                </div>
            </section>
            <main class="t-base__main g-grid g-grid--container">
                <div class="g-col g-col--sm-12 u-is-hidden--xl">
                    <div class="m-accordion js-accordion">
                        <div class="m-accordion__header">
                            <div class="m-accordion__title js-accordion__toggler"><span class="icon icon-ellipsis-v icon--left"></span>
                    Navigation
                </div>
                        </div>
                        <div class="m-accordion__content js-accordion__content">
                            <nav class="m-nav-sidebar" id="nav-sidebar">
                                <ul class="nocontent menu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="t-page-sidebar__content o-content g-col g-col--sm-12 g-col--xl-8 js-anchorer js-highlighter js-widget-copy">
                    <h1>Filter &amp; Sort by Average Rating - Product Reviews</h1>
                    <h2>Prerequisites</h2>
                    <ol>
                        <li value="1">
                Configure your product collector query which provides the <var>product data</var> for your product page map and add the required <var>average rating</var> value.
            </li>
                        <li value="2">
                Amend product page map to make it possible to filter and sort by rating value. Normalize the rating value if it is necessary for your Search engine.
            </li>
                    </ol>
                    <p>If you open an abstract product in your Search engine, you will see the additional sort and facet information with the normalized rating.</p>
       
           Example of product review data in product abstract record in Elasticsearch:
           
           <pre><code class="json">
                 {
                    "_index": "de_search",
                    "_type": "page",
                    "_id": "de.de_de.resource.product_abstract.35",
                    "_score": 1,
                    "_source": {
                       "search-result-data": {
                          "rating": 4.67,
                          "review_count": 3
                       },
                       "integer-sort": {
                          "rating": 467
                       },
                       "integer-facet": [
                          {
                             "facet-name": "rating",
                             "facet-value": [
                                467
                             ]
                          }
                       ]
                    }
                 }
              </code></pre><h3>Adding Average Rating Sort Option</h3><p>Amend your <var>CatalogSearchConfigBuilder</var> and register the average rating sort.</p><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: sort registration</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="php">&lt;?php
    namespace Pyz\Client\Catalog\Plugin\Config;

    use Generated\Shared\Search\PageIndexMap;
    use Generated\Shared\Transfer\SortConfigTransfer;
    use Spryker\Client\Kernel\AbstractPlugin;
    use Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface;
    use Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface;

    class CatalogSearchConfigBuilder extends AbstractPlugin implements SearchConfigBuilderInterface
    {

        const RATING_FACET_NAME = 'rating';

        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
         *
         * @return void
         */
        public function buildSortConfig(SortConfigBuilderInterface $sortConfigBuilder)
        {
            $this-&gt;addDescendingRatingSort($sortConfigBuilder);
            // ...
        }

        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
         *
         * @return $this
         */
        protected function addDescendingRatingSort(SortConfigBuilderInterface $sortConfigBuilder)
        {
            $descendingRatingSortConfig = (new SortConfigTransfer())
                -&gt;setName(static::RATING_FACET_NAME)
                -&gt;setParameterName(static::RATING_FACET_NAME)
                -&gt;setFieldName(PageIndexMap::INTEGER_SORT)
                -&gt;setIsDescending(true);

            $sortConfigBuilder-&gt;addSort($descendingRatingSortConfig);

            return $this;
        }

    }
                </code></pre></div></div><a href="#" name="configure-rating-range-filter"></a><h3>Adding Average Rating Range Filter</h3><p>Amend your <var>CatalogSearchConfigBuilder</var> and register the average rating range filter facet.</p><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: range filter facet registration</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="php">&lt;?php
    namespace Pyz\Client\Catalog\Plugin\Config;

    use Generated\Shared\Transfer\FacetConfigTransfer;
    use Spryker\Client\Kernel\AbstractPlugin;
    use Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface;
    use Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface;

    class CatalogSearchConfigBuilder extends AbstractPlugin implements SearchConfigBuilderInterface
    {
        const RATING_FACET_NAME = 'rating';

        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder
         *
         * @return void
         */
        public function buildFacetConfig(FacetConfigBuilderInterface $facetConfigBuilder)
        {
            $this-&gt;addProductRatingFacet($facetConfigBuilder);
            // ...
        }

        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder
         *
         * @return $this
         */
        protected function addProductRatingFacet(FacetConfigBuilderInterface $facetConfigBuilder)
        {
            $productRatingFacetTransfer = (new FacetConfigTransfer())
                -&gt;setName(static::RATING_FACET_NAME)
                -&gt;setParameterName(static::RATING_FACET_NAME)
                -&gt;setFieldName(PageIndexMap::INTEGER_FACET)
                -&gt;setType(SearchConfig::FACET_TYPE_RANGE);

            $facetConfigBuilder-&gt;addFacet($productRatingFacetTransfer);

            return $this;
        }

    }
                </code></pre></div></div><h3>Float Filtering With Search</h3><p>If your search engine supports only integer filtering, you will need to transform the filter value between display and usage.</p><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: use-case</a></span><div class="MCDropDownBody dropDownBody"><h4>Assumptions</h4><li value="2">Your Search engine is only able to store integer values, such as <var>-1, 0, 1, 2, 3, [...]</var>.</li><li value="3">Your current Product Reviews configuration allows to have float average ratings, such as <var>0.53, 2.41, 4.9, 5 [...]</var>.</li><li value="4">Average rating is limited up to 2 decimals.</li><h4>Complication</h4><p>In this case, you need to temporarily transform the average rating to integer to fit the Search engine's requirements and you also want to keep the original float value so you can display it for the end-users.</p><h4>Solution</h4><p>You can solve this by multiplying/dividing your average rating with 10 to the power of the number of allowed decimals.</p><li value="5">transform displayed value into stored value: <var>2.41 * 10^2 =&gt; 241</var>.</li><li value="6">transform stored value into displayed value: <var>241 / 10^2 =&gt; 2.41</var>.</li></div></div><p>Create a <var>Transformer</var> that implements <var>FacetSearchResultValueTransformerPluginInterface</var> and define the transformation and its inverse.</p><p>Then register this transformer for the already configured rating range filter.</p><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: average rating range filter value transformer</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="php">
    namespace Pyz\Client\ProductReview\Plugin;

    use Spryker\Client\Search\Dependency\Plugin\FacetSearchResultValueTransformerPluginInterface;

    class ProductRatingValueTransformer implements FacetSearchResultValueTransformerPluginInterface
    {

        /**
         * @param array $rangeValues
         *
         * @return array
         */
        public function transformForDisplay($rangeValues)
        {
            if (isset($rangeValues['min'])) {
                $rangeValues['min'] = $this-&gt;normalizeRatingForDisplay($rangeValues['min']);
            }

            if (isset($rangeValues['max'])) {
                $rangeValues['max'] = $this-&gt;normalizeRatingForDisplay($rangeValues['max']);
            }

            return $rangeValues;
        }

        /**
         * @param array $rangeValues
         *
         * @return array
         */
        public function transformFromDisplay($rangeValues)
        {
            if (isset($rangeValues['min'])) {
                $rangeValues['min'] = $this-&gt;normalizeRatingForFilter($rangeValues['min']);
            }

            if (isset($rangeValues['max'])) {
                $rangeValues['max'] = $this-&gt;normalizeRatingForFilter($rangeValues['max']);
            }

            return $rangeValues;
        }

        /**
         * @param int $filteredRating
         *
         * @return int
         */
        protected function normalizeRatingForDisplay($filteredRating)
        {
            return (int)round($filteredRating / 100);
        }

        /**
         * @param int $displayedRating
         *
         * @return int
         */
        protected function normalizeRatingForFilter($displayedRating)
        {
            return $displayedRating * 100;
        }

    }

                </code></pre></div></div><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: range filter value transfer registration</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="php">&lt;?php
        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder
         *
         * @return $this
         */
        protected function addProductRatingFacet(FacetConfigBuilderInterface $facetConfigBuilder)
        {
            $productRatingFacetTransfer = (new FacetConfigTransfer())
                -&gt;setName(static::RATING_FACET_NAME)
                -&gt;setParameterName(static::RATING_FACET_NAME)
                -&gt;setFieldName(PageIndexMap::INTEGER_FACET)
                -&gt;setType(SearchConfig::FACET_TYPE_RANGE)
                -&gt;setValueTransformer(ProductRatingValueTransformer::class);

            $facetConfigBuilder-&gt;addFacet($productRatingFacetTransfer);

            return $this;
        }
                </code></pre></div></div><p>&#160;</p><p><![CDATA[
		]]><i>Last review date: Aug. 28, 2017 </i><![CDATA[		]]></p></div>
                <div class="t-page-sidebar__sidebar g-col g-col--sm-12 g-col--xl-4 u-is-hidden--sm-xl">
                    <section class="a-box a-box--shadow">
                        <nav class="m-nav-sidebar" id="nav-sidebar">
                            <ul class="nocontent menu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                            </ul>
                        </nav>
                    </section>
                </div>
            </main>
            <div class="t-base__footer">
                <footer class="o-footer g-grid g-grid--middle">
                    <nav class="g-grid g-grid--container g-grid--center"><a class="o-footer__link" href="https://spryker.com/privacy-policy" target="_blank">Privacy policy</a><a class="o-footer__link" href="https://spryker.com/partneragb" target="_blank">AGB Partnerprogram</a><a class="o-footer__link" href="https://spryker.com/impressum" target="_blank">Impressum</a>
                    </nav>
                </footer>
            </div><a class="a-scroll-top js-scroll-top" href="#"><span class="a-scroll-top__icon icon icon-chevron-up"></span></a>
            <div class="t-base__overlay js-base-template__toggler">
            </div>
        </div>
        <div class="t-base__off">
            <section class="o-off-canvas">
                <nav class="m-nav-mobile" id="nav-mobile">
                    <ul class="nocontent menu mc-component" data-mc-linked-toc="Data/Tocs/spryker_content.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                    </ul>
                </nav>
            </section>
        </div>
        <script src="/resources/ui/js/academy-ui-manifest.js">
        </script>
        <script src="/resources/ui/js/academy-ui-vendor.js">
        </script>
        <script src="/resources/ui/js/academy-ui-app.js">
        </script>
    </body>
</html>